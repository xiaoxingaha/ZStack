###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                06/Dec/2011  13:44:06 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\Source\SerialApp.c                            #
#    Command line       =  -f E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1. #
#                          4.0_两个实验_专业尚阳\Projects\zstack\Utilities\Se #
#                          rialApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoord. #
#                          cfg (-DCPU32MHZ -DROOT=__near_func                 #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f       #
#                          E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cf #
#                          g (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR    #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\Source\SerialApp.c -D HAL_UART=TRUE -D        #
#                          SERIAL_APP_PORT=0 -D xLCD_SUPPORTED -lC            #
#                          E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\CoordinatorEB\List\ -lA              #
#                          E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\CoordinatorEB\List\ --diag_suppress  #
#                          Pe001,Pa010 -o E:\程序测试目录\十和十二_ZStack-CC2 #
#                          530-2.3.0-1.4.0_两个实验_专业尚阳\Projects\zstack\ #
#                          Utilities\SerialApp\CC2530DB\CoordinatorEB\Obj\    #
#                          -e --require_prototypes --debug --core=plain       #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 8 -I E:\程序测试目录\十和十二_ZS #
#                          tack-CC2530-2.3.0-1.4.0_两个实验_专业尚阳\Projects #
#                          \zstack\Utilities\SerialApp\CC2530DB\ -I           #
#                          E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\..\SOURCE\ -I                        #
#                          E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\..\..\..\ZMAIN\TI2530DB\ -I          #
#                          E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\..\..\..\..\..\COMPONENTS\MT\ -I     #
#                          E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\INCLUD #
#                          E\ -I E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0 #
#                          -1.4.0_两个实验_专业尚阳\Projects\zstack\Utilities #
#                          \SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\ #
#                          TARGET\CC2530EB\ -I E:\程序测试目录\十和十二_ZStac #
#                          k-CC2530-2.3.0-1.4.0_两个实验_专业尚阳\Projects\zs #
#                          tack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\C #
#                          OMPONENTS\OSAL\MCU\CCSOC\ -I                       #
#                          E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\INCLU #
#                          DE\ -I E:\程序测试目录\十和十二_ZStack-CC2530-2.3. #
#                          0-1.4.0_两个实验_专业尚阳\Projects\zstack\Utilitie #
#                          s\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\STA #
#                          CK\AF\ -I E:\程序测试目录\十和十二_ZStack-CC2530-2 #
#                          .3.0-1.4.0_两个实验_专业尚阳\Projects\zstack\Utili #
#                          ties\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\ #
#                          STACK\NWK\ -I E:\程序测试目录\十和十二_ZStack-CC25 #
#                          30-2.3.0-1.4.0_两个实验_专业尚阳\Projects\zstack\U #
#                          tilities\SerialApp\CC2530DB\..\..\..\..\..\COMPONE #
#                          NTS\STACK\SEC\ -I E:\程序测试目录\十和十二_ZStack- #
#                          CC2530-2.3.0-1.4.0_两个实验_专业尚阳\Projects\zsta #
#                          ck\Utilities\SerialApp\CC2530DB\..\..\..\..\..\COM #
#                          PONENTS\STACK\SAPI\ -I E:\程序测试目录\十和十二_ZS #
#                          tack-CC2530-2.3.0-1.4.0_两个实验_专业尚阳\Projects #
#                          \zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\STACK\SYS\ -I                         #
#                          E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\ #
#                           -I E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1 #
#                          .4.0_两个实验_专业尚阳\Projects\zstack\Utilities\S #
#                          erialApp\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F #
#                          8W\ -I E:\程序测试目录\十和十二_ZStack-CC2530-2.3. #
#                          0-1.4.0_两个实验_专业尚阳\Projects\zstack\Utilitie #
#                          s\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\ZMA #
#                          C\ -I E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0 #
#                          -1.4.0_两个实验_专业尚阳\Projects\zstack\Utilities #
#                          \SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\SERV #
#                          ICES\SADDR\ -I E:\程序测试目录\十和十二_ZStack-CC2 #
#                          530-2.3.0-1.4.0_两个实验_专业尚阳\Projects\zstack\ #
#                          Utilities\SerialApp\CC2530DB\..\..\..\..\..\COMPON #
#                          ENTS\SERVICES\SDATA\ -I E:\程序测试目录\十和十二_Z #
#                          Stack-CC2530-2.3.0-1.4.0_两个实验_专业尚阳\Project #
#                          s\zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\ #
#                          ..\COMPONENTS\MAC\INCLUDE\ -I                      #
#                          E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_L #
#                          EVEL\ -I E:\程序测试目录\十和十二_ZStack-CC2530-2. #
#                          3.0-1.4.0_两个实验_专业尚阳\Projects\zstack\Utilit #
#                          ies\SerialApp\CC2530DB\..\..\..\..\..\COMPONENTS\M #
#                          AC\LOW_LEVEL\srf04\ -I E:\程序测试目录\十和十二_ZS #
#                          tack-CC2530-2.3.0-1.4.0_两个实验_专业尚阳\Projects #
#                          \zstack\Utilities\SerialApp\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\ -I   #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3 Evaluation version\8051\INC\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 5.3           #
#                          Evaluation version\8051\INC\CLIB\" -Ohz            #
#    List file          =  E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\CoordinatorEB\List\SerialApp.lst     #
#    Object file        =  E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0 #
#                          _两个实验_专业尚阳\Projects\zstack\Utilities\Seria #
#                          lApp\CC2530DB\CoordinatorEB\Obj\SerialApp.r51      #
#                                                                             #
#                                                                             #
###############################################################################

E:\程序测试目录\十和十二_ZStack-CC2530-2.3.0-1.4.0_两个实验_专业尚阳\Projects\zstack\Utilities\SerialApp\Source\SerialApp.c
      1          /**************************************************************************************************
      2            Filename:       SerialApp.c
      3            Revised:        $Date: 2009-03-29 10:51:47 -0700 (Sun, 29 Mar 2009) $
      4            Revision:       $Revision: 19585 $
      5          
      6            Description -   Serial Transfer Application (no Profile).
      7          
      8          
      9            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This sample application is basically a cable replacement
     42            and it should be customized for your application. A PC
     43            (or other device) sends data via the serial port to this
     44            application's device.  This device transmits the message
     45            to another device with the same application running. The
     46            other device receives the over-the-air message and sends
     47            it to a PC (or other device) connected to its serial port.
     48          				
     49            This application doesn't have a profile, so it handles everything directly.
     50          
     51            Key control:
     52              SW1:
     53              SW2:  initiates end device binding
     54              SW3:
     55              SW4:  initiates a match description request
     56          *********************************************************************/
     57          
     58          /*********************************************************************
     59           * INCLUDES
     60           */
     61          
     62          #include "AF.h"
     63          #include "OnBoard.h"
     64          #include "OSAL_Tasks.h"
     65          #include "SerialApp.h"
     66          #include "ZDApp.h"
     67          #include "ZDObject.h"
     68          #include "ZDProfile.h"
     69          
     70          #include "hal_drivers.h"
     71          #include "hal_key.h"
     72          #if defined ( LCD_SUPPORTED )
     73            #include "hal_lcd.h"
     74          #endif
     75          #include "hal_led.h"
     76          #include "hal_uart.h"
     77          
     78          /*********************************************************************
     79           * MACROS
     80           */
     81          
     82          /*********************************************************************
     83           * CONSTANTS
     84           */
     85          
     86          #if !defined( SERIAL_APP_PORT )
     87          #define SERIAL_APP_PORT  0
     88          #endif
     89          
     90          #if !defined( SERIAL_APP_BAUD )
     91          #define SERIAL_APP_BAUD  HAL_UART_BR_38400
     92          //#define SERIAL_APP_BAUD  HAL_UART_BR_115200
     93          #endif
     94          
     95          // When the Rx buf space is less than this threshold, invoke the Rx callback.
     96          #if !defined( SERIAL_APP_THRESH )
     97          #define SERIAL_APP_THRESH  64
     98          #endif
     99          
    100          #if !defined( SERIAL_APP_RX_SZ )
    101          #define SERIAL_APP_RX_SZ  128
    102          #endif
    103          
    104          #if !defined( SERIAL_APP_TX_SZ )
    105          #define SERIAL_APP_TX_SZ  128
    106          #endif
    107          
    108          // Millisecs of idle time after a byte is received before invoking Rx callback.
    109          #if !defined( SERIAL_APP_IDLE )
    110          #define SERIAL_APP_IDLE  6
    111          #endif
    112          
    113          // Loopback Rx bytes to Tx for throughput testing.
    114          #if !defined( SERIAL_APP_LOOPBACK )
    115          #define SERIAL_APP_LOOPBACK  FALSE
    116          #endif
    117          
    118          // This is the max byte count per OTA message.
    119          #if !defined( SERIAL_APP_TX_MAX )
    120          #define SERIAL_APP_TX_MAX  80
    121          #endif
    122          
    123          #define SERIAL_APP_RSP_CNT  4
    124          
    125          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    126          const cId_t SerialApp_ClusterList[SERIALAPP_MAX_CLUSTERS] =
   \                     SerialApp_ClusterList:
   \   000000   01000200     DW 1, 2
    127          {
    128            SERIALAPP_CLUSTERID1,
    129            SERIALAPP_CLUSTERID2
    130          };
    131          

   \                                 In  segment XDATA_ROM_C, align 1
    132          const SimpleDescriptionFormat_t SerialApp_SimpleDesc =
   \                     SerialApp_SimpleDesc:
   \   000000   0B           DB 11
   \   000001   050F0100     DW 3845, 1
   \   000005   0002         DB 0, 2
   \   000007   ....         DW SerialApp_ClusterList
   \   000009   02           DB 2
   \   00000A   ....         DW SerialApp_ClusterList
    133          {
    134            SERIALAPP_ENDPOINT,              //  int   Endpoint;
    135            SERIALAPP_PROFID,                //  uint16 AppProfId[2];
    136            SERIALAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    137            SERIALAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    138            SERIALAPP_FLAGS,                 //  int   AppFlags:4;
    139            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    140            (cId_t *)SerialApp_ClusterList,  //  byte *pAppInClusterList;
    141            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumOutClusters;
    142            (cId_t *)SerialApp_ClusterList   //  byte *pAppOutClusterList;
    143          };
    144          

   \                                 In  segment XDATA_ROM_C, align 1
    145          const endPointDesc_t SerialApp_epDesc =
   \                     SerialApp_epDesc:
   \   000000   0B           DB 11
   \   000001   ........     DW SerialApp_TaskID, SerialApp_SimpleDesc
   \   000005   00           DB 0
    146          {
    147            SERIALAPP_ENDPOINT,
    148           &SerialApp_TaskID,
    149            (SimpleDescriptionFormat_t *)&SerialApp_SimpleDesc,
    150            noLatencyReqs
    151          };
    152          
    153          /*********************************************************************
    154           * TYPEDEFS
    155           */
    156          
    157          /*********************************************************************
    158           * GLOBAL VARIABLES
    159           */
    160          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    161          uint8 SerialApp_TaskID;    // Task ID for internal task/event processing.
   \                     SerialApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    162          
    163          /*********************************************************************
    164           * EXTERNAL VARIABLES
    165           */
    166          
    167          /*********************************************************************
    168           * EXTERNAL FUNCTIONS
    169           */
    170          
    171          /*********************************************************************
    172           * LOCAL VARIABLES
    173           */
    174          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    175          static uint8 SerialApp_MsgID;
   \                     SerialApp_MsgID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    176          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    177          static afAddrType_t SerialApp_TxAddr;
   \                     SerialApp_TxAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    178          static uint8 SerialApp_TxSeq;
   \                     SerialApp_TxSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    179          static uint8 SerialApp_TxBuf[SERIAL_APP_TX_MAX+1];
   \                     SerialApp_TxBuf:
   \   000000                DS 81
   \   000051                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    180          static uint8 SerialApp_TxLen;
   \                     SerialApp_TxLen:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    181          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    182          static afAddrType_t SerialApp_RxAddr;
   \                     SerialApp_RxAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    183          static uint8 SerialApp_RxSeq;
   \                     SerialApp_RxSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    184          static uint8 SerialApp_RspBuf[SERIAL_APP_RSP_CNT];
   \                     SerialApp_RspBuf:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    185          
    186          /*********************************************************************
    187           * LOCAL FUNCTIONS
    188           */
    189          
    190          static void SerialApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    191          static void SerialApp_HandleKeys( uint8 shift, uint8 keys );
    192          static void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt );
    193          static void SerialApp_Send(void);
    194          static void SerialApp_Resp(void);
    195          static void SerialApp_CallBack(uint8 port, uint8 event);
    196          
    197          /*********************************************************************
    198           * @fn      SerialApp_Init
    199           *
    200           * @brief   This is called during OSAL tasks' initialization.
    201           *
    202           * @param   task_id - the Task ID assigned by OSAL.
    203           *
    204           * @return  none
    205           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    206          void SerialApp_Init( uint8 task_id )
   \                     SerialApp_Init:
    207          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV     A,#-0x1d
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    208            halUARTCfg_t uartConfig;
    209          
    210            SerialApp_TaskID = task_id;
   \   00000C   90....       MOV     DPTR,#SerialApp_TaskID
   \   00000F   F0           MOVX    @DPTR,A
    211            SerialApp_RxSeq = 0xC3;
   \   000010   74C3         MOV     A,#-0x3d
   \   000012   90....       MOV     DPTR,#SerialApp_RxSeq
   \   000015   F0           MOVX    @DPTR,A
    212          
    213            afRegister( (endPointDesc_t *)&SerialApp_epDesc );
   \   000016                ; Setup parameters for call to function afRegister
   \   000016   7A..         MOV     R2,#(SerialApp_epDesc & 0xff)
   \   000018   7B..         MOV     R3,#((SerialApp_epDesc >> 8) & 0xff)
   \   00001A   12....       LCALL   ??afRegister?relay
    214          
    215            RegisterForKeys( task_id );
   \   00001D                ; Setup parameters for call to function RegisterForKeys
   \   00001D   EE           MOV     A,R6
   \   00001E   F9           MOV     R1,A
   \   00001F   12....       LCALL   ??RegisterForKeys?relay
    216          
    217            uartConfig.configured           = TRUE;              // 2x30 don't care - see uart driver.
   \   000022   7401         MOV     A,#0x1
   \   000024   85..82       MOV     DPL,?XSP + 0
   \   000027   85..83       MOV     DPH,?XSP + 1
   \   00002A   F0           MOVX    @DPTR,A
    218            uartConfig.baudRate             = SERIAL_APP_BAUD;
   \   00002B   12....       LCALL   ?XSTACK_DISP0_8
   \   00002E   7402         MOV     A,#0x2
   \   000030   F0           MOVX    @DPTR,A
    219            uartConfig.flowControl          = FALSE;
   \   000031   12....       LCALL   ?XSTACK_DISP0_8
   \   000034   E4           CLR     A
   \   000035   F0           MOVX    @DPTR,A
    220            uartConfig.flowControlThreshold = SERIAL_APP_THRESH; // 2x30 don't care - see uart driver.
   \   000036   7403         MOV     A,#0x3
   \   000038   12....       LCALL   ?XSTACK_DISP0_8
   \   00003B   7440         MOV     A,#0x40
   \   00003D   F0           MOVX    @DPTR,A
   \   00003E   A3           INC     DPTR
   \   00003F   E4           CLR     A
   \   000040   F0           MOVX    @DPTR,A
    221            uartConfig.rx.maxBufSize        = SERIAL_APP_RX_SZ;  // 2x30 don't care - see uart driver.
   \   000041   740A         MOV     A,#0xa
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   7480         MOV     A,#-0x80
   \   000048   F0           MOVX    @DPTR,A
   \   000049   A3           INC     DPTR
   \   00004A   E4           CLR     A
   \   00004B   F0           MOVX    @DPTR,A
    222            uartConfig.tx.maxBufSize        = SERIAL_APP_TX_SZ;  // 2x30 don't care - see uart driver.
   \   00004C   7412         MOV     A,#0x12
   \   00004E   12....       LCALL   ?XSTACK_DISP0_8
   \   000051   7480         MOV     A,#-0x80
   \   000053   F0           MOVX    @DPTR,A
   \   000054   A3           INC     DPTR
   \   000055   E4           CLR     A
   \   000056   F0           MOVX    @DPTR,A
    223            uartConfig.idleTimeout          = SERIAL_APP_IDLE;   // 2x30 don't care - see uart driver.
   \   000057   7405         MOV     A,#0x5
   \   000059   12....       LCALL   ?XSTACK_DISP0_8
   \   00005C   7406         MOV     A,#0x6
   \   00005E   F0           MOVX    @DPTR,A
    224            uartConfig.intEnable            = TRUE;              // 2x30 don't care - see uart driver.
   \   00005F   7416         MOV     A,#0x16
   \   000061   12....       LCALL   ?XSTACK_DISP0_8
   \   000064   7401         MOV     A,#0x1
   \   000066   F0           MOVX    @DPTR,A
    225            uartConfig.callBackFunc         = SerialApp_CallBack;
   \   000067   741B         MOV     A,#0x1b
   \   000069   12....       LCALL   ?XSTACK_DISP0_8
   \   00006C   74..         MOV     A,#(??SerialApp_CallBack?relay & 0xff)
   \   00006E   F0           MOVX    @DPTR,A
   \   00006F   A3           INC     DPTR
   \   000070   74..         MOV     A,#((??SerialApp_CallBack?relay >> 8) & 0xff)
   \   000072   F0           MOVX    @DPTR,A
    226            HalUARTOpen (SERIAL_APP_PORT, &uartConfig);
   \   000073                ; Setup parameters for call to function HalUARTOpen
   \   000073   85..82       MOV     DPL,?XSP + 0
   \   000076   85..83       MOV     DPH,?XSP + 1
   \   000079   AA82         MOV     R2,DPL
   \   00007B   AB83         MOV     R3,DPH
   \   00007D   7900         MOV     R1,#0x0
   \   00007F   12....       LCALL   ??HalUARTOpen?relay
    227          
    228          #if defined ( LCD_SUPPORTED )
    229            HalLcdWriteString( "SerialApp", HAL_LCD_LINE_2 );
    230          #endif
    231            
    232            ZDO_RegisterForZDOMsg( SerialApp_TaskID, End_Device_Bind_rsp );
   \   000082                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000082   7A20         MOV     R2,#0x20
   \   000084   7B80         MOV     R3,#-0x80
   \   000086   90....       MOV     DPTR,#SerialApp_TaskID
   \   000089   E0           MOVX    A,@DPTR
   \   00008A   F9           MOV     R1,A
   \   00008B   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    233            ZDO_RegisterForZDOMsg( SerialApp_TaskID, Match_Desc_rsp );
   \   00008E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00008E   7A06         MOV     R2,#0x6
   \   000090   7B80         MOV     R3,#-0x80
   \   000092   90....       MOV     DPTR,#SerialApp_TaskID
   \   000095   E0           MOVX    A,@DPTR
   \   000096   F9           MOV     R1,A
   \   000097   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    234          }
   \   00009A   741D         MOV     A,#0x1d
   \   00009C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009F   7F01         MOV     R7,#0x1
   \   0000A1   02....       LJMP    ?BANKED_LEAVE_XDATA
    235          
    236          /*********************************************************************
    237           * @fn      SerialApp_ProcessEvent
    238           *
    239           * @brief   Generic Application Task event processor.
    240           *
    241           * @param   task_id  - The OSAL assigned task ID.
    242           * @param   events   - Bit map of events to process.
    243           *
    244           * @return  Event flags of all unprocessed events.
    245           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    246          UINT16 SerialApp_ProcessEvent( uint8 task_id, UINT16 events )
   \                     SerialApp_ProcessEvent:
    247          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    248            (void)task_id;  // Intentionally unreferenced parameter
    249            
    250            if ( events & SYS_EVENT_MSG )
   \   00000E   7480         MOV     A,#-0x80
   \   000010   5F           ANL     A,R7
   \   000011   F9           MOV     R1,A
   \   000012   E4           CLR     A
   \   000013   7001         JNZ     ??SerialApp_ProcessEvent_0
   \   000015   E9           MOV     A,R1
   \                     ??SerialApp_ProcessEvent_0:
   \   000016   701E         JNZ     ??SerialApp_ProcessEvent_1
    251            {
    252              afIncomingMSGPacket_t *MSGpkt;
    253          
    254              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SerialApp_TaskID )) )
    255              {
    256                switch ( MSGpkt->hdr.event )
    257                {
    258                case ZDO_CB_MSG:
    259                  SerialApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    260                  break;
    261                    
    262                case KEY_CHANGE:
    263                  SerialApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    264                  break;
    265          
    266                case AF_INCOMING_MSG_CMD:
    267                  SerialApp_ProcessMSGCmd( MSGpkt );
    268                  break;
    269          
    270                default:
    271                  break;
    272                }
    273          
    274                osal_msg_deallocate( (uint8 *)MSGpkt );
    275              }
    276          
    277              return ( events ^ SYS_EVENT_MSG );
    278            }
    279          
    280            if ( events & SERIALAPP_SEND_EVT )
   \   000018   EE           MOV     A,R6
   \   000019   A2E0         MOV     C,0xE0 /* A   */.0
   \   00001B   4003         JC      $+5
   \   00001D   02....       LJMP    ??SerialApp_ProcessEvent_2 & 0xFFFF
    281            {
    282              SerialApp_Send();
   \   000020                ; Setup parameters for call to function SerialApp_Send
   \   000020   12....       LCALL   ??SerialApp_Send?relay
    283              return ( events ^ SERIALAPP_SEND_EVT );
   \   000023   7401         MOV     A,#0x1
   \   000025   6E           XRL     A,R6
   \   000026   FA           MOV     R2,A
   \   000027   EF           MOV     A,R7
   \                     ??SerialApp_ProcessEvent_3:
   \   000028   FB           MOV     R3,A
   \   000029   02....       LJMP    ??SerialApp_ProcessEvent_4 & 0xFFFF
    284            }
   \                     ??SerialApp_ProcessEvent_5:
   \   00002C                ; Setup parameters for call to function SerialApp_ProcessMSGCmd
   \   00002C   12....       LCALL   ??SerialApp_ProcessMSGCmd?relay
   \                     ??SerialApp_ProcessEvent_6:
   \   00002F                ; Setup parameters for call to function osal_msg_deallocate
   \   00002F   AA..         MOV     R2,?V0 + 2
   \   000031   AB..         MOV     R3,?V0 + 3
   \   000033   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??SerialApp_ProcessEvent_1:
   \   000036                ; Setup parameters for call to function osal_msg_receive
   \   000036   90....       MOV     DPTR,#SerialApp_TaskID
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   F9           MOV     R1,A
   \   00003B   12....       LCALL   ??osal_msg_receive?relay
   \   00003E   8A..         MOV     ?V0 + 2,R2
   \   000040   8B..         MOV     ?V0 + 3,R3
   \   000042   EA           MOV     A,R2
   \   000043   7001         JNZ     ??SerialApp_ProcessEvent_7
   \   000045   EB           MOV     A,R3
   \                     ??SerialApp_ProcessEvent_7:
   \   000046   7003         JNZ     $+5
   \   000048   02....       LJMP    ??SerialApp_ProcessEvent_8 & 0xFFFF
   \   00004B   8A82         MOV     DPL,R2
   \   00004D   8B83         MOV     DPH,R3
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for SerialApp_ProcessEvent>_0`:
   \   000053   00           DB        0
   \   000054   03           DB        3
   \   000055   1A           DB        26
   \   000056   ....         DW        ??SerialApp_ProcessEvent_5
   \   000058   C0           DB        192
   \   000059   ....         DW        ??SerialApp_ProcessEvent_9
   \   00005B   D3           DB        211
   \   00005C   ....         DW        ??SerialApp_ProcessEvent_10
   \   00005E   ....         DW        ??SerialApp_ProcessEvent_6
   \                     ??SerialApp_ProcessEvent_10:
   \   000060   EA           MOV     A,R2
   \   000061   240C         ADD     A,#0xc
   \   000063   F582         MOV     DPL,A
   \   000065   EB           MOV     A,R3
   \   000066   3400         ADDC    A,#0x0
   \   000068   F583         MOV     DPH,A
   \   00006A   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   00006D   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for SerialApp_ProcessEvent>_1`:
   \   000070   0000         DW        0
   \   000072   0200         DW        2
   \   000074   0680         DW        32774
   \   000076   ....         DW        ??SerialApp_ProcessEvent_11
   \   000078   2080         DW        32800
   \   00007A   ....         DW        ??SerialApp_ProcessEvent_12
   \   00007C   ....         DW        ??SerialApp_ProcessEvent_6
   \                     ??SerialApp_ProcessEvent_12:
   \   00007E   EA           MOV     A,R2
   \   00007F   2413         ADD     A,#0x13
   \   000081   F582         MOV     DPL,A
   \   000083   EB           MOV     A,R3
   \   000084   3400         ADDC    A,#0x0
   \   000086   F583         MOV     DPH,A
   \   000088   E0           MOVX    A,@DPTR
   \   000089   F8           MOV     R0,A
   \   00008A   A3           INC     DPTR
   \   00008B   E0           MOVX    A,@DPTR
   \   00008C   F583         MOV     DPH,A
   \   00008E   8882         MOV     DPL,R0
   \   000090   E0           MOVX    A,@DPTR
   \   000091   7009         JNZ     ??SerialApp_ProcessEvent_13
   \   000093                ; Setup parameters for call to function HalLedSet
   \   000093   7A01         MOV     R2,#0x1
   \                     ??SerialApp_ProcessEvent_14:
   \   000095   7908         MOV     R1,#0x8
   \   000097   12....       LCALL   ??HalLedSet?relay
   \   00009A   8093         SJMP    ??SerialApp_ProcessEvent_6
   \                     ??SerialApp_ProcessEvent_13:
   \   00009C                ; Setup parameters for call to function HalLedSet
   \   00009C   7A04         MOV     R2,#0x4
   \   00009E   80F5         SJMP    ??SerialApp_ProcessEvent_14
   \                     ??SerialApp_ProcessEvent_11:
   \   0000A0                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   0000A0   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   0000A3   8A..         MOV     ?V0 + 0,R2
   \   0000A5   8B..         MOV     ?V0 + 1,R3
   \   0000A7   EA           MOV     A,R2
   \   0000A8   7001         JNZ     ??SerialApp_ProcessEvent_15
   \   0000AA   EB           MOV     A,R3
   \                     ??SerialApp_ProcessEvent_15:
   \   0000AB   6082         JZ      ??SerialApp_ProcessEvent_6
   \   0000AD   8A82         MOV     DPL,R2
   \   0000AF   8B83         MOV     DPH,R3
   \   0000B1   E0           MOVX    A,@DPTR
   \   0000B2   7032         JNZ     ??SerialApp_ProcessEvent_16
   \   0000B4   A3           INC     DPTR
   \   0000B5   A3           INC     DPTR
   \   0000B6   A3           INC     DPTR
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   602C         JZ      ??SerialApp_ProcessEvent_16
   \   0000BA   7402         MOV     A,#0x2
   \   0000BC   90....       MOV     DPTR,#(SerialApp_TxAddr + 8)
   \   0000BF   F0           MOVX    @DPTR,A
   \   0000C0   8A82         MOV     DPL,R2
   \   0000C2   8B83         MOV     DPH,R3
   \   0000C4   A3           INC     DPTR
   \   0000C5   E0           MOVX    A,@DPTR
   \   0000C6   F8           MOV     R0,A
   \   0000C7   A3           INC     DPTR
   \   0000C8   E0           MOVX    A,@DPTR
   \   0000C9   F9           MOV     R1,A
   \   0000CA   90....       MOV     DPTR,#SerialApp_TxAddr
   \   0000CD   E8           MOV     A,R0
   \   0000CE   F0           MOVX    @DPTR,A
   \   0000CF   A3           INC     DPTR
   \   0000D0   E9           MOV     A,R1
   \   0000D1   F0           MOVX    @DPTR,A
   \   0000D2   8A82         MOV     DPL,R2
   \   0000D4   8B83         MOV     DPH,R3
   \   0000D6   A3           INC     DPTR
   \   0000D7   A3           INC     DPTR
   \   0000D8   A3           INC     DPTR
   \   0000D9   A3           INC     DPTR
   \   0000DA   E0           MOVX    A,@DPTR
   \   0000DB   90....       MOV     DPTR,#(SerialApp_TxAddr + 9)
   \   0000DE   F0           MOVX    @DPTR,A
   \   0000DF                ; Setup parameters for call to function HalLedSet
   \   0000DF   7A01         MOV     R2,#0x1
   \   0000E1   7908         MOV     R1,#0x8
   \   0000E3   12....       LCALL   ??HalLedSet?relay
   \                     ??SerialApp_ProcessEvent_16:
   \   0000E6                ; Setup parameters for call to function osal_mem_free
   \   0000E6   AA..         MOV     R2,?V0 + 0
   \   0000E8   AB..         MOV     R3,?V0 + 1
   \   0000EA   12....       LCALL   ??osal_mem_free?relay
   \   0000ED   02....       LJMP    ??SerialApp_ProcessEvent_6 & 0xFFFF
   \                     ??SerialApp_ProcessEvent_9:
   \   0000F0   8A82         MOV     DPL,R2
   \   0000F2   8B83         MOV     DPH,R3
   \   0000F4   A3           INC     DPTR
   \   0000F5   A3           INC     DPTR
   \   0000F6   A3           INC     DPTR
   \   0000F7   E0           MOVX    A,@DPTR
   \   0000F8   7003         JNZ     $+5
   \   0000FA   02....       LJMP    ??SerialApp_ProcessEvent_6 & 0xFFFF
   \   0000FD                ; Setup parameters for call to function HalLedSet
   \   0000FD   7A00         MOV     R2,#0x0
   \   0000FF   7908         MOV     R1,#0x8
   \   000101   12....       LCALL   ??HalLedSet?relay
   \   000104   7408         MOV     A,#0x8
   \   000106   12....       LCALL   ?XSTACK_DISP0_8
   \   000109   740F         MOV     A,#0xf
   \   00010B   F0           MOVX    @DPTR,A
   \   00010C   85..82       MOV     DPL,?XSP + 0
   \   00010F   85..83       MOV     DPH,?XSP + 1
   \   000112   74FF         MOV     A,#-0x1
   \   000114   F0           MOVX    @DPTR,A
   \   000115   A3           INC     DPTR
   \   000116   F0           MOVX    @DPTR,A
   \   000117   75....       MOV     ?V0 + 0,#(SerialApp_ClusterList & 0xff)
   \   00011A   75....       MOV     ?V0 + 1,#((SerialApp_ClusterList >> 8) & 0xff)
   \   00011D                ; Setup parameters for call to function ZDP_MatchDescReq
   \   00011D   75..00       MOV     ?V0 + 4,#0x0
   \   000120   78..         MOV     R0,#?V0 + 4
   \   000122   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000125   78..         MOV     R0,#?V0 + 0
   \   000127   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00012A   75..02       MOV     ?V0 + 4,#0x2
   \   00012D   78..         MOV     R0,#?V0 + 4
   \   00012F   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000132   78..         MOV     R0,#?V0 + 0
   \   000134   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000137   75..05       MOV     ?V0 + 0,#0x5
   \   00013A   75..0F       MOV     ?V0 + 1,#0xf
   \   00013D   78..         MOV     R0,#?V0 + 0
   \   00013F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000142   7902         MOV     R1,#0x2
   \   000144   7CFF         MOV     R4,#-0x1
   \   000146   7DFF         MOV     R5,#-0x1
   \   000148   7408         MOV     A,#0x8
   \   00014A   12....       LCALL   ?XSTACK_DISP0_8
   \   00014D   AA82         MOV     R2,DPL
   \   00014F   AB83         MOV     R3,DPH
   \   000151   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   000154   7408         MOV     A,#0x8
   \   000156   12....       LCALL   ?DEALLOC_XSTACK8
   \   000159   02....       LJMP    ??SerialApp_ProcessEvent_6 & 0xFFFF
   \                     ??SerialApp_ProcessEvent_8:
   \   00015C   EE           MOV     A,R6
   \   00015D   FA           MOV     R2,A
   \   00015E   7480         MOV     A,#-0x80
   \   000160   6F           XRL     A,R7
   \   000161   02....       LJMP    ??SerialApp_ProcessEvent_3 & 0xFFFF
    285          
    286            if ( events & SERIALAPP_RESP_EVT )
   \                     ??SerialApp_ProcessEvent_2:
   \   000164   5402         ANL     A,#0x2
   \   000166   6053         JZ      ??SerialApp_ProcessEvent_17
    287            {
    288              SerialApp_Resp();
   \   000168                ; Setup parameters for call to function AF_DataRequest
   \   000168   75..1E       MOV     ?V0 + 0,#0x1e
   \   00016B   78..         MOV     R0,#?V0 + 0
   \   00016D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000170   75....       MOV     ?V0 + 0,#(SerialApp_MsgID & 0xff)
   \   000173   75....       MOV     ?V0 + 1,#((SerialApp_MsgID >> 8) & 0xff)
   \   000176   78..         MOV     R0,#?V0 + 0
   \   000178   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00017B   75....       MOV     ?V0 + 0,#(SerialApp_RspBuf & 0xff)
   \   00017E   75....       MOV     ?V0 + 1,#((SerialApp_RspBuf >> 8) & 0xff)
   \   000181   78..         MOV     R0,#?V0 + 0
   \   000183   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000186   75..04       MOV     ?V0 + 0,#0x4
   \   000189   75..00       MOV     ?V0 + 1,#0x0
   \   00018C   78..         MOV     R0,#?V0 + 0
   \   00018E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000191   75..02       MOV     ?V0 + 0,#0x2
   \   000194   78..         MOV     R0,#?V0 + 0
   \   000196   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000199   7900         MOV     R1,#0x0
   \   00019B   7C..         MOV     R4,#(SerialApp_epDesc & 0xff)
   \   00019D   7D..         MOV     R5,#((SerialApp_epDesc >> 8) & 0xff)
   \   00019F   7A..         MOV     R2,#(SerialApp_RxAddr & 0xff)
   \   0001A1   7B..         MOV     R3,#((SerialApp_RxAddr >> 8) & 0xff)
   \   0001A3   12....       LCALL   ??AF_DataRequest?relay
   \   0001A6   7409         MOV     A,#0x9
   \   0001A8   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001AB   E9           MOV     A,R1
   \   0001AC   6005         JZ      ??CrossCallReturnLabel_4
   \   0001AE                ; Setup parameters for call to function osal_set_event
   \   0001AE   7A02         MOV     R2,#0x2
   \   0001B0   12....       LCALL   ?Subroutine2 & 0xFFFF
    289              return ( events ^ SERIALAPP_RESP_EVT );
   \                     ??CrossCallReturnLabel_4:
   \   0001B3   7402         MOV     A,#0x2
   \   0001B5   6E           XRL     A,R6
   \   0001B6   FA           MOV     R2,A
   \   0001B7   EF           MOV     A,R7
   \   0001B8   FB           MOV     R3,A
   \   0001B9   8004         SJMP    ??SerialApp_ProcessEvent_4
    290            }
    291          
    292            return ( 0 );  // Discard unknown events.
   \                     ??SerialApp_ProcessEvent_17:
   \   0001BB   7A00         MOV     R2,#0x0
   \   0001BD   7B00         MOV     R3,#0x0
   \                     ??SerialApp_ProcessEvent_4:
   \   0001BF   7409         MOV     A,#0x9
   \   0001C1   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001C4                REQUIRE ?Subroutine3
   \   0001C4                ; // Fall through to label ?Subroutine3
    293          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7F06         MOV     R7,#0x6
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F5..         MOV     ?V0 + 0,A
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   F5..         MOV     ?V0 + 1,A
   \   000007   78..         MOV     R0,#?V0 + 0
   \   000009   22           RET
    294          
    295          /*********************************************************************
    296           * @fn      SerialApp_ProcessZDOMsgs()
    297           *
    298           * @brief   Process response messages
    299           *
    300           * @param   none
    301           *
    302           * @return  none
    303           */
    304          static void SerialApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
    305          {
    306            switch ( inMsg->clusterID )
    307            {
    308              case End_Device_Bind_rsp:
    309                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    310                {
    311                  // Light LED
    312                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    313                }
    314          #if defined(BLINK_LEDS)
    315                else
    316                {
    317                  // Flash LED to show failure
    318                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
    319                }
    320          #endif
    321                break;
    322                
    323              case Match_Desc_rsp:
    324                {
    325                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
    326                  if ( pRsp )
    327                  {
    328                    if ( pRsp->status == ZSuccess && pRsp->cnt )
    329                    {
    330                      SerialApp_TxAddr.addrMode = (afAddrMode_t)Addr16Bit;
    331                      SerialApp_TxAddr.addr.shortAddr = pRsp->nwkAddr;
    332                      // Take the first endpoint, Can be changed to search through endpoints
    333                      SerialApp_TxAddr.endPoint = pRsp->epList[0];
    334                      
    335                      // Light LED
    336                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    337                    }
    338                    osal_mem_free( pRsp );
    339                  }
    340                }
    341                break;
    342            }
    343          }
    344          
    345          /*********************************************************************
    346           * @fn      SerialApp_HandleKeys
    347           *
    348           * @brief   Handles all key events for this device.
    349           *
    350           * @param   shift - true if in shift/alt.
    351           * @param   keys  - bit field for key events.
    352           *
    353           * @return  none
    354           */
    355          void SerialApp_HandleKeys( uint8 shift, uint8 keys )
    356          {
    357            zAddrType_t txAddr;
    358          
    359              /*if ( keys & HAL_KEY_SW_6 )
    360              {
    361                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    362                
    363                // Initiate an End Device Bind Request for the mandatory endpoint
    364                txAddr.addrMode = Addr16Bit;
    365                txAddr.addr.shortAddr = 0x0000; // Coordinator
    366                ZDP_EndDeviceBindReq( &txAddr, NLME_GetShortAddr(), 
    367                                      SerialApp_epDesc.endPoint,
    368                                      SERIALAPP_PROFID,
    369                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    370                                      SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    371                                      FALSE );
    372              }*/
    373          
    374          
    375              if ( keys )//( keys & HAL_KEY_SW_4 ) //HAL_KEY_SW_4 -> HAL_KEY_SW_6
    376              {
    377                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    378                
    379                // Initiate a Match Description Request (Service Discovery)
    380                txAddr.addrMode = AddrBroadcast;
    381                txAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    382                ZDP_MatchDescReq( &txAddr, NWK_BROADCAST_SHORTADDR,
    383                                  SERIALAPP_PROFID,
    384                                  SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    385                                  SERIALAPP_MAX_CLUSTERS, (cId_t *)SerialApp_ClusterList,
    386                                  FALSE );
    387              }
    388          }
    389          
    390          /*********************************************************************
    391           * @fn      SerialApp_ProcessMSGCmd
    392           *
    393           * @brief   Data message processor callback. This function processes
    394           *          any incoming data - probably from other devices. Based
    395           *          on the cluster ID, perform the intended action.
    396           *
    397           * @param   pkt - pointer to the incoming message packet
    398           *
    399           * @return  TRUE if the 'pkt' parameter is being used and will be freed later,
    400           *          FALSE otherwise.
    401           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine4_0:
   \   000000   90....       MOV     DPTR,#SerialApp_TaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??osal_set_event?relay
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    402          void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt )
   \                     SerialApp_ProcessMSGCmd:
    403          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    404            uint8 stat;
    405            uint8 seqnb;
    406            uint8 delay;
    407          
    408            switch ( pkt->clusterId )
   \   000009   EE           MOV     A,R6
   \   00000A   2421         ADD     A,#0x21
   \   00000C   F5..         MOV     ?V0 + 4,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F5..         MOV     ?V0 + 5,A
   \   000013   8E82         MOV     DPL,R6
   \   000015   8F83         MOV     DPH,R7
   \   000017   A3           INC     DPTR
   \   000018   A3           INC     DPTR
   \   000019   A3           INC     DPTR
   \   00001A   A3           INC     DPTR
   \   00001B   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   00001E   12....       LCALL   ?US_SWITCH_DENSE
   \                     `?<Jumptable for SerialApp_ProcessMSGCmd>_0`:
   \   000021   0100         DW        1
   \   000023   01           DB        1
   \   000024   ....         DW        ??SerialApp_ProcessMSGCmd_0
   \   000026   ....         DW        ??SerialApp_ProcessMSGCmd_1
   \   000028   ....         DW        ??SerialApp_ProcessMSGCmd_2
    409            {
    410            // A message with a serial data block to be transmitted on the serial port.
    411            case SERIALAPP_CLUSTERID1:
    412              // Store the address for sending and retrying.
    413              osal_memcpy(&SerialApp_RxAddr, &(pkt->srcAddr), sizeof( afAddrType_t ));
   \                     ??SerialApp_ProcessMSGCmd_1:
   \   00002A                ; Setup parameters for call to function osal_memcpy
   \   00002A   EE           MOV     A,R6
   \   00002B   2406         ADD     A,#0x6
   \   00002D   F5..         MOV     ?V0 + 0,A
   \   00002F   EF           MOV     A,R7
   \   000030   3400         ADDC    A,#0x0
   \   000032   F5..         MOV     ?V0 + 1,A
   \   000034   75..00       MOV     ?V0 + 2,#0x0
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00003C   7C0C         MOV     R4,#0xc
   \   00003E   7D00         MOV     R5,#0x0
   \   000040   7A..         MOV     R2,#(SerialApp_RxAddr & 0xff)
   \   000042   7B..         MOV     R3,#((SerialApp_RxAddr >> 8) & 0xff)
   \   000044   12....       LCALL   ??osal_memcpy?relay
   \   000047   7403         MOV     A,#0x3
   \   000049   12....       LCALL   ?DEALLOC_XSTACK8
    414          
    415              seqnb = pkt->cmd.Data[0];
   \   00004C   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   F5..         MOV     ?V0 + 0,A
    416          
    417              // Keep message if not a repeat packet
    418              if ( (seqnb > SerialApp_RxSeq) ||                    // Normal
    419                  ((seqnb < 0x80 ) && ( SerialApp_RxSeq > 0x80)) ) // Wrap-around
   \   000052   90....       MOV     DPTR,#SerialApp_RxSeq
   \   000055   E0           MOVX    A,@DPTR
   \   000056   C3           CLR     C
   \   000057   95..         SUBB    A,?V0 + 0
   \   000059   400D         JC      ??SerialApp_ProcessMSGCmd_3
   \   00005B   E5..         MOV     A,?V0 + 0
   \   00005D   C3           CLR     C
   \   00005E   9480         SUBB    A,#-0x80
   \   000060   503D         JNC     ??SerialApp_ProcessMSGCmd_4
   \   000062   E0           MOVX    A,@DPTR
   \   000063   C3           CLR     C
   \   000064   9481         SUBB    A,#-0x7f
   \   000066   4037         JC      ??SerialApp_ProcessMSGCmd_4
    420              {
    421                // Transmit the data on the serial port.
    422                if ( HalUARTWrite( SERIAL_APP_PORT, pkt->cmd.Data+1, (pkt->cmd.DataLength-1) ) )
   \                     ??SerialApp_ProcessMSGCmd_3:
   \   000068                ; Setup parameters for call to function HalUARTWrite
   \   000068   EE           MOV     A,R6
   \   000069   241F         ADD     A,#0x1f
   \   00006B   F582         MOV     DPL,A
   \   00006D   EF           MOV     A,R7
   \   00006E   3400         ADDC    A,#0x0
   \   000070   F583         MOV     DPH,A
   \   000072   E0           MOVX    A,@DPTR
   \   000073   24FF         ADD     A,#-0x1
   \   000075   FC           MOV     R4,A
   \   000076   A3           INC     DPTR
   \   000077   E0           MOVX    A,@DPTR
   \   000078   34FF         ADDC    A,#-0x1
   \   00007A   FD           MOV     R5,A
   \   00007B   8882         MOV     DPL,R0
   \   00007D   8983         MOV     DPH,R1
   \   00007F   A3           INC     DPTR
   \   000080   AA82         MOV     R2,DPL
   \   000082   AB83         MOV     R3,DPH
   \   000084   7900         MOV     R1,#0x0
   \   000086   12....       LCALL   ??HalUARTWrite?relay
   \   000089   EA           MOV     A,R2
   \   00008A   7001         JNZ     ??SerialApp_ProcessMSGCmd_5
   \   00008C   EB           MOV     A,R3
   \                     ??SerialApp_ProcessMSGCmd_5:
   \   00008D   600A         JZ      ??SerialApp_ProcessMSGCmd_6
    423                {
    424                  // Save for next incoming message
    425                  SerialApp_RxSeq = seqnb;
   \   00008F   E5..         MOV     A,?V0 + 0
   \   000091   90....       MOV     DPTR,#SerialApp_RxSeq
   \   000094   F0           MOVX    @DPTR,A
    426                  stat = OTA_SUCCESS;
   \   000095   7A00         MOV     R2,#0x0
   \   000097   8008         SJMP    ??SerialApp_ProcessMSGCmd_7
    427                }
    428                else
    429                {
    430                  stat = OTA_SER_BUSY;
   \                     ??SerialApp_ProcessMSGCmd_6:
   \   000099   7A02         MOV     R2,#0x2
   \   00009B   7B10         MOV     R3,#0x10
   \   00009D   8004         SJMP    ??SerialApp_ProcessMSGCmd_8
    431                }
    432              }
    433              else
    434              {
    435                stat = OTA_DUP_MSG;
   \                     ??SerialApp_ProcessMSGCmd_4:
   \   00009F   7A01         MOV     R2,#0x1
   \                     ??SerialApp_ProcessMSGCmd_7:
   \   0000A1   7B01         MOV     R3,#0x1
    436              }
    437          
    438              // Select approproiate OTA flow-control delay.
    439              delay = (stat == OTA_SER_BUSY) ? SERIALAPP_NAK_DELAY : SERIALAPP_ACK_DELAY;
    440          
    441              // Build & send OTA response message.
    442              SerialApp_RspBuf[0] = stat;
   \                     ??SerialApp_ProcessMSGCmd_8:
   \   0000A3   EA           MOV     A,R2
   \   0000A4   90....       MOV     DPTR,#SerialApp_RspBuf
   \   0000A7   F0           MOVX    @DPTR,A
    443              SerialApp_RspBuf[1] = seqnb;
   \   0000A8   E5..         MOV     A,?V0 + 0
   \   0000AA   90....       MOV     DPTR,#(SerialApp_RspBuf + 1)
   \   0000AD   F0           MOVX    @DPTR,A
    444              SerialApp_RspBuf[2] = LO_UINT16( delay );
   \   0000AE   EB           MOV     A,R3
   \   0000AF   90....       MOV     DPTR,#(SerialApp_RspBuf + 2)
   \   0000B2   F0           MOVX    @DPTR,A
    445              SerialApp_RspBuf[3] = HI_UINT16( delay );
   \   0000B3   E4           CLR     A
   \   0000B4   90....       MOV     DPTR,#(SerialApp_RspBuf + 3)
   \   0000B7   F0           MOVX    @DPTR,A
    446              osal_set_event( SerialApp_TaskID, SERIALAPP_RESP_EVT );
   \   0000B8                ; Setup parameters for call to function osal_set_event
   \   0000B8   7A02         MOV     R2,#0x2
   \   0000BA   FB           MOV     R3,A
   \   0000BB   12....       LCALL   ??Subroutine4_0 & 0xFFFF
    447              osal_stop_timerEx(SerialApp_TaskID, SERIALAPP_RESP_EVT);
   \                     ??CrossCallReturnLabel_6:
   \   0000BE                ; Setup parameters for call to function osal_stop_timerEx
   \   0000BE   7A02         MOV     R2,#0x2
   \   0000C0   7B00         MOV     R3,#0x0
   \                     ??SerialApp_ProcessMSGCmd_9:
   \   0000C2   90....       MOV     DPTR,#SerialApp_TaskID
   \   0000C5   E0           MOVX    A,@DPTR
   \   0000C6   F9           MOV     R1,A
   \   0000C7   12....       LCALL   ??osal_stop_timerEx?relay
   \   0000CA   8038         SJMP    ??SerialApp_ProcessMSGCmd_0
    448              break;
    449          
    450            // A response to a received serial data block.
    451            case SERIALAPP_CLUSTERID2:
    452              if ((pkt->cmd.Data[1] == SerialApp_TxSeq) &&
    453                 ((pkt->cmd.Data[0] == OTA_SUCCESS) || (pkt->cmd.Data[0] == OTA_DUP_MSG)))
   \                     ??SerialApp_ProcessMSGCmd_2:
   \   0000CC   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   0000CF   A3           INC     DPTR
   \   0000D0   E0           MOVX    A,@DPTR
   \   0000D1   FA           MOV     R2,A
   \   0000D2   90....       MOV     DPTR,#SerialApp_TxSeq
   \   0000D5   E0           MOVX    A,@DPTR
   \   0000D6   6A           XRL     A,R2
   \   0000D7   7015         JNZ     ??SerialApp_ProcessMSGCmd_10
   \   0000D9   8882         MOV     DPL,R0
   \   0000DB   8983         MOV     DPH,R1
   \   0000DD   E0           MOVX    A,@DPTR
   \   0000DE   6004         JZ      ??SerialApp_ProcessMSGCmd_11
   \   0000E0   6401         XRL     A,#0x1
   \   0000E2   700A         JNZ     ??SerialApp_ProcessMSGCmd_10
    454              {
    455                SerialApp_TxLen = 0;
   \                     ??SerialApp_ProcessMSGCmd_11:
   \   0000E4   E4           CLR     A
   \   0000E5   90....       MOV     DPTR,#SerialApp_TxLen
   \   0000E8   F0           MOVX    @DPTR,A
    456                osal_stop_timerEx(SerialApp_TaskID, SERIALAPP_SEND_EVT);
   \   0000E9                ; Setup parameters for call to function osal_stop_timerEx
   \   0000E9   7A01         MOV     R2,#0x1
   \   0000EB   FB           MOV     R3,A
   \   0000EC   80D4         SJMP    ??SerialApp_ProcessMSGCmd_9
    457              }
    458              else
    459              {
    460                // Re-start timeout according to delay sent from other device.
    461                delay = BUILD_UINT16( pkt->cmd.Data[2], pkt->cmd.Data[3] );
    462                osal_start_timerEx( SerialApp_TaskID, SERIALAPP_SEND_EVT, delay );
   \                     ??SerialApp_ProcessMSGCmd_10:
   \   0000EE                ; Setup parameters for call to function osal_start_timerEx
   \   0000EE   8882         MOV     DPL,R0
   \   0000F0   8983         MOV     DPH,R1
   \   0000F2   A3           INC     DPTR
   \   0000F3   A3           INC     DPTR
   \   0000F4   E0           MOVX    A,@DPTR
   \   0000F5   FC           MOV     R4,A
   \   0000F6   7D00         MOV     R5,#0x0
   \   0000F8   7A01         MOV     R2,#0x1
   \   0000FA   7B00         MOV     R3,#0x0
   \   0000FC   90....       MOV     DPTR,#SerialApp_TaskID
   \   0000FF   E0           MOVX    A,@DPTR
   \   000100   F9           MOV     R1,A
   \   000101   12....       LCALL   ??osal_start_timerEx?relay
    463              }
    464              break;
    465          
    466              default:
    467                break;
    468            }
    469          }
   \                     ??SerialApp_ProcessMSGCmd_0:
   \   000104   02....       LJMP    ?Subroutine3 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   85..82       MOV     DPL,?V0 + 4
   \   000003   85..83       MOV     DPH,?V0 + 5
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F8           MOV     R0,A
   \   000008   A3           INC     DPTR
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   F9           MOV     R1,A
   \   00000B   8882         MOV     DPL,R0
   \   00000D   8983         MOV     DPH,R1
   \   00000F   22           RET
    470          
    471          /*********************************************************************
    472           * @fn      SerialApp_Send
    473           *
    474           * @brief   Send data OTA.
    475           *
    476           * @param   none
    477           *
    478           * @return  none
    479           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7B00         MOV     R3,#0x0
   \   000002                REQUIRE ??Subroutine4_0
   \   000002                ; // Fall through to label ??Subroutine4_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    480          static void SerialApp_Send(void)
   \                     SerialApp_Send:
    481          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    482          #if SERIAL_APP_LOOPBACK
    483            if (SerialApp_TxLen < SERIAL_APP_TX_MAX)
    484            {
    485              SerialApp_TxLen += HalUARTRead(SERIAL_APP_PORT, SerialApp_TxBuf+SerialApp_TxLen+1,
    486                                                              SERIAL_APP_TX_MAX-SerialApp_TxLen);
    487            }
    488          
    489            if (SerialApp_TxLen)
    490            {
    491              (void)SerialApp_TxAddr;
    492              if (HalUARTWrite(SERIAL_APP_PORT, SerialApp_TxBuf+1, SerialApp_TxLen))
    493              {
    494                SerialApp_TxLen = 0;
    495              }
    496              else
    497              {
    498                osal_set_event(SerialApp_TaskID, SERIALAPP_SEND_EVT);
    499              }
    500            }
    501          #else
    502            if (!SerialApp_TxLen && 
    503                (SerialApp_TxLen = HalUARTRead(SERIAL_APP_PORT, SerialApp_TxBuf+1, SERIAL_APP_TX_MAX)))
   \   000005   90....       MOV     DPTR,#SerialApp_TxLen
   \   000008   E0           MOVX    A,@DPTR
   \   000009   701E         JNZ     ??SerialApp_Send_0
   \   00000B                ; Setup parameters for call to function HalUARTRead
   \   00000B   7C50         MOV     R4,#0x50
   \   00000D   7D00         MOV     R5,#0x0
   \   00000F   7A..         MOV     R2,#((SerialApp_TxBuf + 1) & 0xff)
   \   000011   7B..         MOV     R3,#(((SerialApp_TxBuf + 1) >> 8) & 0xff)
   \   000013   7900         MOV     R1,#0x0
   \   000015   12....       LCALL   ??HalUARTRead?relay
   \   000018   EA           MOV     A,R2
   \   000019   90....       MOV     DPTR,#SerialApp_TxLen
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   6061         JZ      ??CrossCallReturnLabel_5
    504            {
    505              // Pre-pend sequence number to the Tx message.
    506              SerialApp_TxBuf[0] = ++SerialApp_TxSeq;
   \   00001F   90....       MOV     DPTR,#SerialApp_TxSeq
   \   000022   E0           MOVX    A,@DPTR
   \   000023   04           INC     A
   \   000024   F0           MOVX    @DPTR,A
   \   000025   90....       MOV     DPTR,#SerialApp_TxBuf
   \   000028   F0           MOVX    @DPTR,A
    507            }
    508          
    509            if (SerialApp_TxLen)
    510            {
    511              if (afStatus_SUCCESS != AF_DataRequest(&SerialApp_TxAddr,
    512                                                     (endPointDesc_t *)&SerialApp_epDesc,
    513                                                      SERIALAPP_CLUSTERID1,
    514                                                      SerialApp_TxLen+1, SerialApp_TxBuf,
    515                                                      &SerialApp_MsgID, 0, AF_DEFAULT_RADIUS))
   \                     ??SerialApp_Send_0:
   \   000029                ; Setup parameters for call to function AF_DataRequest
   \   000029   75..1E       MOV     ?V0 + 0,#0x1e
   \   00002C   78..         MOV     R0,#?V0 + 0
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000031   75....       MOV     ?V0 + 0,#(SerialApp_MsgID & 0xff)
   \   000034   75....       MOV     ?V0 + 1,#((SerialApp_MsgID >> 8) & 0xff)
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   75....       MOV     ?V0 + 0,#(SerialApp_TxBuf & 0xff)
   \   00003F   75....       MOV     ?V0 + 1,#((SerialApp_TxBuf >> 8) & 0xff)
   \   000042   78..         MOV     R0,#?V0 + 0
   \   000044   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000047   90....       MOV     DPTR,#SerialApp_TxLen
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   F8           MOV     R0,A
   \   00004C   7401         MOV     A,#0x1
   \   00004E   28           ADD     A,R0
   \   00004F   F5..         MOV     ?V0 + 0,A
   \   000051   E4           CLR     A
   \   000052   3400         ADDC    A,#0x0
   \   000054   F5..         MOV     ?V0 + 1,A
   \   000056   78..         MOV     R0,#?V0 + 0
   \   000058   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005B   75..01       MOV     ?V0 + 0,#0x1
   \   00005E   75..00       MOV     ?V0 + 1,#0x0
   \   000061   78..         MOV     R0,#?V0 + 0
   \   000063   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000066   7900         MOV     R1,#0x0
   \   000068   7C..         MOV     R4,#(SerialApp_epDesc & 0xff)
   \   00006A   7D..         MOV     R5,#((SerialApp_epDesc >> 8) & 0xff)
   \   00006C   7A..         MOV     R2,#(SerialApp_TxAddr & 0xff)
   \   00006E   7B..         MOV     R3,#((SerialApp_TxAddr >> 8) & 0xff)
   \   000070   12....       LCALL   ??AF_DataRequest?relay
   \   000073   7409         MOV     A,#0x9
   \   000075   12....       LCALL   ?DEALLOC_XSTACK8
   \   000078   E9           MOV     A,R1
   \   000079   6005         JZ      ??CrossCallReturnLabel_5
    516              {
    517                osal_set_event(SerialApp_TaskID, SERIALAPP_SEND_EVT);
   \   00007B                ; Setup parameters for call to function osal_set_event
   \   00007B   7A01         MOV     R2,#0x1
   \   00007D   12....       LCALL   ?Subroutine2 & 0xFFFF
    518              }
    519            }
    520          #endif
    521          }
   \                     ??CrossCallReturnLabel_5:
   \   000080   7F02         MOV     R7,#0x2
   \   000082   02....       LJMP    ?BANKED_LEAVE_XDATA
    522          
    523          /*********************************************************************
    524           * @fn      SerialApp_Resp
    525           *
    526           * @brief   Send data OTA.
    527           *
    528           * @param   none
    529           *
    530           * @return  none
    531           */
    532          static void SerialApp_Resp(void)
    533          {
    534            if (afStatus_SUCCESS != AF_DataRequest(&SerialApp_RxAddr,
    535                                                   (endPointDesc_t *)&SerialApp_epDesc,
    536                                                    SERIALAPP_CLUSTERID2,
    537                                                    SERIAL_APP_RSP_CNT, SerialApp_RspBuf,
    538                                                   &SerialApp_MsgID, 0, AF_DEFAULT_RADIUS))
    539            {
    540              osal_set_event(SerialApp_TaskID, SERIALAPP_RESP_EVT);
    541            }
    542          }
    543          
    544          /*********************************************************************
    545           * @fn      SerialApp_CallBack
    546           *
    547           * @brief   Send data OTA.
    548           *
    549           * @param   port - UART port.
    550           * @param   event - the UART port event flag.
    551           *
    552           * @return  none
    553           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    554          static void SerialApp_CallBack(uint8 port, uint8 event)
   \                     SerialApp_CallBack:
    555          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    556            (void)port;
    557          
    558            if ((event & (HAL_UART_RX_FULL | HAL_UART_RX_ABOUT_FULL | HAL_UART_RX_TIMEOUT)) &&
    559          #if SERIAL_APP_LOOPBACK
    560                (SerialApp_TxLen < SERIAL_APP_TX_MAX))
    561          #else
    562                !SerialApp_TxLen)
   \   000004   7407         MOV     A,#0x7
   \   000006   5A           ANL     A,R2
   \   000007   6009         JZ      ??SerialApp_CallBack_0
   \   000009   90....       MOV     DPTR,#SerialApp_TxLen
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   7003         JNZ     ??SerialApp_CallBack_0
    563          #endif
    564            {
    565              SerialApp_Send();
   \   00000F                ; Setup parameters for call to function SerialApp_Send
   \   00000F   12....       LCALL   ??SerialApp_Send?relay
    566            }
    567          }
   \                     ??SerialApp_CallBack_0:
   \   000012   D083         POP     DPH
   \   000014   D082         POP     DPL
   \   000016   02....       LJMP    ?BRET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_ProcessMSGCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ProcessMSGCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_Send?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_Send

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_CallBack?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_CallBack
    568          
    569          /*********************************************************************
    570          *********************************************************************/

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     SerialApp_CallBack               2      0      0
       -> SerialApp_Send              4      0      0
     SerialApp_Init                   1      0     38
       -> afRegister                  0      0     76
       -> RegisterForKeys             0      0     76
       -> HalUARTOpen                 0      0     76
       -> ZDO_RegisterForZDOMsg       0      0     76
       -> ZDO_RegisterForZDOMsg       0      0     76
     SerialApp_ProcessEvent           1      0     32
       -> SerialApp_Send              0      0     46
       -> SerialApp_ProcessMSGCmd     0      0     46
       -> osal_msg_deallocate         0      0     46
       -> osal_msg_receive            0      0     46
       -> HalLedSet                   0      0     46
       -> HalLedSet                   0      0     46
       -> ZDO_ParseEPListRsp          0      0     46
       -> HalLedSet                   0      0     46
       -> osal_mem_free               0      0     46
       -> HalLedSet                   0      0     46
       -> ZDP_MatchDescReq            0      0     62
       -> AF_DataRequest              0      0     64
       -> osal_set_event              0      0     46
     SerialApp_ProcessMSGCmd          0      0     40
       -> osal_memcpy                 0      0     34
       -> HalUARTWrite                0      0     28
       -> osal_set_event              0      0     28
       -> osal_stop_timerEx           0      0     28
       -> osal_stop_timerEx           0      0     28
       -> osal_start_timerEx          0      0     28
     SerialApp_Send                   0      0     42
       -> HalUARTRead                 0      0     20
       -> AF_DataRequest              0      0     38
       -> osal_set_event              0      0     20


   Segment part sizes:

     Function/Label                  Bytes
     --------------                  -----
     SerialApp_ClusterList              4
     SerialApp_SimpleDesc              12
     SerialApp_epDesc                   6
     SerialApp_TaskID                   1
     SerialApp_MsgID                    1
     SerialApp_TxAddr                  12
     SerialApp_TxSeq                    1
     SerialApp_TxBuf                   81
     SerialApp_TxLen                    1
     SerialApp_RxAddr                  12
     SerialApp_RxSeq                    1
     SerialApp_RspBuf                   4
     SerialApp_Init                   164
     SerialApp_ProcessEvent           452
     ?Subroutine3                       5
     ?Subroutine0                      10
     ??Subroutine4_0                    9
     SerialApp_ProcessMSGCmd          263
     ?Subroutine1                      16
     ?Subroutine2                       2
     SerialApp_Send                   133
     SerialApp_CallBack                25
     ??SerialApp_Init?relay             6
     ??SerialApp_ProcessEvent?relay     6
     ??SerialApp_ProcessMSGCmd?relay    6
     ??SerialApp_Send?relay             6
     ??SerialApp_CallBack?relay         6

 
 1 079 bytes in segment BANKED_CODE
    30 bytes in segment BANK_RELAYS
    22 bytes in segment XDATA_ROM_C
   114 bytes in segment XDATA_Z
 
 1 109 bytes of CODE  memory
    22 bytes of CONST memory
   114 bytes of XDATA memory

Errors: none
Warnings: none
